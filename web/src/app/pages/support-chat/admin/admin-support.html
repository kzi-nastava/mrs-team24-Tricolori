<div class="flex h-[calc(100vh-80px)] bg-white">
  
  <!-- Users Sidebar -->
  <div class="w-80 border-r border-gray-200 flex flex-col bg-gray-50">
    <div class="p-4 border-b border-gray-200 bg-white">
      <h2 class="text-lg font-semibold text-gray-900">Active Chats</h2>
    </div>
    
    <div class="flex-1 overflow-y-auto">
      @for (user of chatUsers; track user.id) {
        <button
          (click)="selectUser(user)"
          [class]="'w-full p-4 flex items-center gap-3 hover:bg-gray-100 transition border-b border-gray-200 text-left ' + 
                   (selectedUser?.id === user.id ? 'bg-white' : '')"
        >
          <!-- User Avatar with Color -->
          <div 
            class="w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0"
            [style.background-color]="user.color"
          >
            <span class="text-white font-semibold text-lg">
              {{ user.name.charAt(0) }}
            </span>
          </div>
          
          <!-- User Info -->
          <div class="flex-1 min-w-0">
            <div class="flex items-center justify-between mb-1">
              <h3 [class]="'font-medium text-gray-900 ' + (user.hasUnread ? 'font-bold' : '')">
                {{ user.name }}
              </h3>
              @if (user.hasUnread) {
                <span class="w-3 h-3 bg-red-500 rounded-full flex-shrink-0"></span>
              }
            </div>
            <p class="text-sm text-gray-500 truncate">{{ user.lastMessage }}</p>
          </div>
        </button>
      }
    </div>
  </div>
  
  <!-- Chat Area -->
  <div class="flex-1 flex flex-col">
    
    @if (selectedUser) {
      <!-- Chat Header -->
      <div class="p-4 border-b border-gray-200 bg-white">
        <div class="flex items-center gap-3">
          <div 
            class="w-10 h-10 rounded-full flex items-center justify-center"
            [style.background-color]="selectedUser.color"
          >
            <span class="text-white font-semibold">
              {{ selectedUser.name.charAt(0) }}
            </span>
          </div>
          <h2 class="text-lg font-semibold text-gray-900">{{ selectedUser.name }}</h2>
        </div>
      </div>
      
      <!-- Chat Messages -->
      <div class="flex-1 overflow-y-auto px-6 py-8 chat-messages">
        <div class="max-w-4xl mx-auto space-y-6">
          
          @for (message of messages; track message.id) {
            <div [class]="message.isFromAdmin ? 'flex justify-end items-start gap-3' : 'flex justify-start items-start gap-3'">
              
              <!-- User Avatar (for user messages) -->
              @if (!message.isFromAdmin) {
                <div 
                  class="w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0"
                  [style.background-color]="selectedUser.color"
                >
                  <span class="text-white font-semibold">
                    {{ selectedUser.name.charAt(0) }}
                  </span>
                </div>
              }
              
              <!-- Message Bubble -->
              <div [class]="message.isFromAdmin ? 'flex flex-col items-end' : 'flex flex-col items-start'">
                <div [class]="message.isFromAdmin 
                  ? 'bg-[#b2ebf2] text-gray-900 px-6 py-3 rounded-3xl max-w-md' 
                  : 'bg-gray-200 text-gray-900 px-6 py-3 rounded-3xl max-w-md'">
                  {{ message.text }}
                </div>
                <span class="text-xs text-gray-500 mt-1 px-2">{{ message.timestamp }}</span>
              </div>
              
              <!-- Admin Avatar (for admin messages) -->
              @if (message.isFromAdmin) {
                <div class="w-10 h-10 rounded-full bg-[#00acc1] flex items-center justify-center flex-shrink-0">
                  <ng-icon name="heroUser" class="w-6 h-6 text-white"></ng-icon>
                </div>
              }
              
            </div>
          }
          
        </div>
      </div>
      
      <!-- Message Input Area -->
      <div class="border-t border-gray-200 px-6 py-4 bg-white">
        <div class="max-w-4xl mx-auto">
          <form (ngSubmit)="sendMessage()" class="flex items-center gap-3">
            <input
              type="text"
              [(ngModel)]="newMessage"
              name="message"
              placeholder="Type your message..."
              (keydown.enter)="$event.preventDefault(); sendMessage()"
              class="flex-1 px-6 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-[#00acc1] focus:border-transparent"
            />
            <button
              type="submit"
              [disabled]="!newMessage.trim()"
              class="bg-[#00acc1] hover:bg-[#008c9e] text-white p-4 rounded-full transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
            >
              <ng-icon name="heroPaperAirplane" class="w-5 h-5"></ng-icon>
            </button>
          </form>
        </div>
      </div>
    }
    
    @if (!selectedUser) {
      <div class="flex-1 flex items-center justify-center text-gray-400">
        <p>Select a user to start chatting</p>
      </div>
    }
    
  </div>
  
</div>