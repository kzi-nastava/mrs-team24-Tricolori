<div class="flex flex-col lg:flex-row w-full h-[calc(100vh-80px)] bg-gray-100">
  
  <!-- Info Panel (Left Side on Desktop, Top on Mobile) -->
  <div class="w-full lg:w-1/3 bg-white shadow-lg p-6 overflow-y-auto z-10 lg:h-full min-h-100">
    
    <!-- Header with Icon -->
    <div class="flex items-center gap-3 mb-4">
      @if (showEstimateForm || estimateResults) {
        <button
          (click)="goBack()"
          class="flex items-center gap-1 px-3 py-2 hover:bg-gray-100 rounded-lg transition text-gray-700 font-medium text-sm">
          <ng-icon name="heroArrowLeft" class="w-4 h-4"></ng-icon>
          < Back
        </button>
      }
      @if (!showEstimateForm && !estimateResults) {
        <ng-icon name="heroMapPin" class="w-6 h-6 text-base-600"></ng-icon>
      }
      <h2 class="text-xl font-semibold text-base-900 m-0">Plan Your Ride</h2>
    </div>

    @if (!showEstimateForm) {
      <!-- Initial State - Estimate Button -->
       <button
        (click)="showEstimateForm = true"
        class="w-full bg-white border-2 border-base-600 py-3 rounded-lg text-base font-medium transition hover:bg-base-100 hover:text-base-700 focus:bg-base-100 focus:text-base-700 focus:outline-none focus:ring-2 focus:ring-base-600 flex items-center justify-center gap-2">
        <ng-icon name="heroCalculator" class="w-5 h-5"></ng-icon>
        Estimate your ride
      </button>

      <!-- Driver Stats -->
      <div class="grid grid-cols-2 gap-4 mt-6">
        <div class="bg-cyan-50 rounded-lg p-4">
          <div class="text-2xl font-bold text-base-900">{{ availableDrivers }}</div>
          <div class="text-sm text-gray-600">Available Drivers</div>
        </div>
        <div class="bg-pink-50 rounded-lg p-4">
          <div class="text-2xl font-bold text-base-900 flex items-center gap-1">
            {{ averageRating }}
            <ng-icon name="heroStar" class="w-5 h-5 text-yellow-500"></ng-icon>
          </div>
          <div class="text-sm text-gray-600">Average Rating</div>
        </div>
      </div>
    }

    @if (showEstimateForm && !estimateResults) {
      <!-- Estimation Form -->
      <form [formGroup]="estimateForm" (ngSubmit)="onEstimate()">
        
        <!-- Pickup Location -->
        <div class="mb-4">
          <label class="block text-base-800 mb-2 text-sm font-medium">Pickup Location</label>
          <div class="relative w-full">
            <ng-icon name="heroMapPin" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-cyan-500"></ng-icon>
            <input
              type="text"
              formControlName="pickup"
              placeholder="Enter pickup location"
              class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-base-600 focus:border-transparent">
          </div>
        </div>

        <!-- Destination -->
        <div class="mb-4">
          <label class="block text-base-800 mb-2 text-sm font-medium">Destination</label>
          <div class="relative w-full">
            <ng-icon name="heroMapPin" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-pink-500"></ng-icon>
            <input
              type="text"
              formControlName="destination"
              placeholder="Where to?"
              class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-base-600 focus:border-transparent">
          </div>
        </div>

        <!-- Error Message -->
        @if (errorMessage) {
          <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg mb-4 text-sm">
            {{ errorMessage }}
          </div>
        }

        <!-- Get Estimate Button -->
        <button
          type="submit"
          class="w-full bg-base-600 hover:bg-base-700 text-white py-3 rounded-lg font-medium transition flex items-center justify-center gap-2">
          <ng-icon name="heroSparkles" class="w-5 h-5"></ng-icon>
          Get Estimate
        </button>
      </form>
    }

    @if (estimateResults) {
      <!-- Estimation Results -->
      <div>
        <!-- Route Info -->
        <div class="mb-4 pb-4 border-b border-gray-200">
          <div class="flex items-start gap-2 mb-2">
            <ng-icon name="heroMapPin" class="w-5 h-5 text-cyan-500 mt-0.5"></ng-icon>
            <span class="text-sm text-gray-700">{{ estimateResults.pickup }}</span>
          </div>
          <div class="flex items-start gap-2">
            <ng-icon name="heroMapPin" class="w-5 h-5 text-pink-500 mt-0.5"></ng-icon>
            <span class="text-sm text-gray-700">{{ estimateResults.destination }}</span>
          </div>
        </div>

        <!-- Trip Summary -->
        <div class="bg-cyan-50 rounded-lg p-4 mb-4">
          <div class="flex items-center gap-2 mb-3">
            <ng-icon name="heroInformationCircle" class="w-5 h-5 text-base-600"></ng-icon>
            <span class="text-sm font-medium text-base-800">Trip Summary</span>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <div class="text-xl font-bold text-base-900">{{ estimateResults.distance }}</div>
              <div class="text-xs text-gray-600">km</div>
            </div>
            <div>
              <div class="text-xl font-bold text-base-900">{{ estimateResults.duration }}</div>
              <div class="text-xs text-gray-600">min</div>
            </div>
          </div>
        </div>

        <!-- Choose Your Ride -->
        <div class="mb-4">
          <div class="flex items-center gap-2 mb-3">
            <ng-icon name="heroCurrencyDollar" class="w-5 h-5 text-base-600"></ng-icon>
            <span class="text-sm font-medium text-base-800">Choose Your Ride</span>
          </div>
          
          <div class="space-y-2">
            @for (option of rideOptions; track option.type) {
              <div class="border border-gray-200 rounded-lg p-3 hover:border-base-600 transition cursor-pointer">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="text-2xl">{{ option.icon }}</div>
                    <div>
                      <div class="font-medium text-base-900">{{ option.type }}</div>
                      <div class="text-xs text-gray-600 flex items-center gap-1">
                        <ng-icon name="heroClock" class="w-3 h-3"></ng-icon>
                        {{ option.eta }}
                      </div>
                    </div>
                  </div>
                  <div class="text-right">
                    <div class="font-bold text-base-900">{{ option.price }}</div>
                    <div class="text-xs text-gray-600">{{ option.seats }}</div>
                  </div>
                </div>
              </div>
            }
          </div>
        </div>

        <!-- New Estimate Button -->
        <button
          (click)="resetEstimate()"
          class="w-full bg-white border border-gray-300 text-gray-700 py-3 rounded-lg font-medium transition hover:bg-gray-50 flex items-center justify-center gap-2">
          <ng-icon name="heroArrowPath" class="w-5 h-5"></ng-icon>
          New Estimate
        </button>

        <!-- Login Prompt -->
        <div class="mt-4 bg-blue-50 rounded-lg p-4 text-center">
          <p class="text-sm text-gray-700 mb-2">Want to book this ride?</p>
          <a routerLink="/login" class="text-base-600 font-medium text-sm hover:underline">
            Login or Register to continue
          </a>
        </div>
      </div>
    }

  </div>

  <!-- Map Container (Right Side on Desktop, Bottom on Mobile) -->
  <div class="w-full lg:w-2/3 h-[50vh] lg:h-full relative">
    <div id="map" class="w-full h-full"></div>

    <!-- Map Legend (Bottom Right) -->
    <div class="absolute bottom-6 right-6 bg-white rounded-lg shadow-lg p-4 z-10">
      <h3 class="text-sm font-semibold text-base-900 mb-3 m-0">Vehicle Status</h3>
      <div class="space-y-2">
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 bg-green-500 rounded-full"></div>
          <span class="text-xs text-gray-700">Available</span>
        </div>
        <div class="flex items-center gap-2">
          <div class="w-3 h-3 bg-red-500 rounded-full"></div>
          <span class="text-xs text-gray-700">Occupied</span>
        </div>
      </div>
    </div>
  </div>

</div>